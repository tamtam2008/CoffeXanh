{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WaterfallList = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactNativeSpringScrollview = require(\"react-native-spring-scrollview\");\n\nvar _reactNative = require(\"react-native\");\n\nvar _styles = require(\"./styles\");\n\nvar _idx = require(\"./idx\");\n\nvar _WaterfallItem = require(\"./WaterfallItem\");\n\nvar _jsxFileName = \"C:\\\\Users\\\\ADMINS\\\\Desktop\\\\GreenApp\\\\CoffeXanh\\\\node_modules\\\\react-native-largelist-v3\\\\WaterfallList.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nvar screenLayout = _reactNative.Dimensions.get(\"window\");\n\nvar screenHeight = Math.max(screenLayout.width, screenLayout.height);\n\nvar WaterfallList = function (_React$PureComponent) {\n  (0, _inherits2.default)(WaterfallList, _React$PureComponent);\n\n  var _super = _createSuper(WaterfallList);\n\n  function WaterfallList(props) {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, WaterfallList);\n    _this = _super.call(this, props);\n    _this._contentOffsetY = 0;\n    _this._shouldUpdateContent = true;\n    _this._scrollView = _react.default.createRef();\n\n    _this._onSizeChange = function (size) {\n      _this._size = size;\n      if (_this._shouldRenderContent()) _this.forceUpdate();\n    };\n\n    _this._onHeaderLayout = function (e) {\n      if (_this._headerLayout && _this._headerLayout.height === e.nativeEvent.layout.height) return;\n      _this._headerLayout = e.nativeEvent.layout;\n      _this._orgOnHeaderLayout && _this._orgOnHeaderLayout(e);\n      if (_this._shouldRenderContent()) _this.forceUpdate();\n    };\n\n    _this._onFooterLayout = function (e) {\n      if (_this._footerLayout && _this._footerLayout.height === e.nativeEvent.layout.height) return;\n      _this._footerLayout = e.nativeEvent.layout;\n      _this._orgOnFooterLayout && _this._orgOnFooterLayout(e);\n      if (_this._shouldRenderContent()) _this.forceUpdate();\n    };\n\n    _this._onScroll = function (e) {\n      _this._contentOffsetY = e.nativeEvent.contentOffset.y;\n      var now = new Date().getTime();\n\n      if (_this._lastTick - now > 30) {\n        _this._lastTick = now;\n        return;\n      }\n\n      _this._lastTick = now;\n      _this._shouldUpdateContent && _this._itemRefs.forEach(function (column) {\n        return column.forEach(function (itemRef) {\n          return (0, _idx.idx)(function () {\n            return itemRef.current.updateOffset(_this._contentOffsetY);\n          });\n        });\n      });\n      _this._shouldUpdateContent && _this.props.onScroll && _this.props.onScroll(e);\n    };\n\n    _this.obtainOffset();\n\n    return _this;\n  }\n\n  (0, _createClass2.default)(WaterfallList, [{\n    key: \"UNSAFE_componentWillReceiveProps\",\n    value: function UNSAFE_componentWillReceiveProps(props) {\n      if (props.onNativeContentOffsetExtract && this.props.onNativeContentOffsetExtract !== props.onNativeContentOffsetExtract) {\n        this.obtainOffset();\n      }\n    }\n  }, {\n    key: \"obtainOffset\",\n    value: function obtainOffset() {\n      this._nativeOffset = _objectSpread({\n        x: new _reactNative.Animated.Value(0),\n        y: new _reactNative.Animated.Value(0)\n      }, this.props.onNativeContentOffsetExtract);\n      this._offset = this._nativeOffset.y;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          numColumns = _this$props.numColumns,\n          heightForItem = _this$props.heightForItem,\n          data = _this$props.data,\n          preferColumnWidth = _this$props.preferColumnWidth;\n      var columnSummaries = [];\n      var sumHeight = null;\n\n      if (this._shouldRenderContent()) {\n        this._itemRefs = [];\n        sumHeight = (0, _idx.idx)(function () {\n          return _this2._headerLayout.height;\n        }, 0);\n        if (!numColumns) numColumns = Math.floor(this._size.width / preferColumnWidth);\n\n        for (var i = 0; i < numColumns; ++i) {\n          columnSummaries.push({\n            sumHeight: 0,\n            indexes: [],\n            tops: [],\n            heights: [],\n            cells: [],\n            inputs: [],\n            outputs: [],\n            itemIndexes: [],\n            inputItemIndexes: []\n          });\n        }\n\n        data.forEach(function (item, index) {\n          var height = heightForItem(item, index);\n          var minHeight = Number.MAX_SAFE_INTEGER;\n          var minHeightIndex = 0;\n          columnSummaries.forEach(function (summary, idx) {\n            if (minHeight > summary.sumHeight) {\n              minHeight = summary.sumHeight;\n              minHeightIndex = idx;\n            }\n          });\n          var lastHeight = (0, _idx.idx)(function () {\n            return columnSummaries[minHeightIndex].heights[columnSummaries[minHeightIndex].heights.length - 1];\n          }, 0);\n          columnSummaries[minHeightIndex].sumHeight += height;\n          columnSummaries[minHeightIndex].heights.push(height);\n          columnSummaries[minHeightIndex].indexes.push(index);\n          var lastTop = (0, _idx.idx)(function () {\n            return columnSummaries[minHeightIndex].tops[columnSummaries[minHeightIndex].tops.length - 1];\n          }, (0, _idx.idx)(function () {\n            return _this2._headerLayout.height;\n          }, 0));\n          columnSummaries[minHeightIndex].tops.push(lastTop + lastHeight);\n        });\n        var maxHeight = Number.MIN_SAFE_INTEGER;\n        columnSummaries.forEach(function (summary) {\n          if (maxHeight < summary.sumHeight) {\n            maxHeight = summary.sumHeight;\n          }\n\n          var viewport = [];\n          summary.tops.forEach(function (top, index) {\n            var first = viewport[0];\n\n            if (first !== undefined && top + summary.heights[index] - first > screenHeight) {\n              viewport.splice(0, 1);\n            }\n\n            viewport.push(top);\n\n            while (summary.cells.length < viewport.length + 2) {\n              summary.cells.push(summary.cells.length);\n            }\n          });\n        });\n        sumHeight += maxHeight;\n        sumHeight += (0, _idx.idx)(function () {\n          return _this2._footerLayout.height;\n        }, 0);\n        if (sumHeight <= this._size.height) sumHeight = this._size.height + _reactNative.StyleSheet.hairlineWidth;\n        columnSummaries.forEach(function (summary) {\n          summary.indexes.forEach(function (itemIndex, index) {\n            var cellIndex = index % summary.cells.length;\n\n            if (!summary.inputs[cellIndex]) {\n              summary.inputs[cellIndex] = [Number.MIN_SAFE_INTEGER];\n              summary.inputItemIndexes[cellIndex] = [itemIndex];\n            }\n\n            if (!summary.outputs[cellIndex]) summary.outputs[cellIndex] = [(0, _idx.idx)(function () {\n              return summary.tops[index];\n            }, 0)];\n            if (!summary.itemIndexes[cellIndex]) summary.itemIndexes[cellIndex] = [];\n            summary.inputs[cellIndex].push(summary.tops[index] - _this2._size.height, summary.tops[index] - _this2._size.height + 0.1);\n            summary.inputItemIndexes[cellIndex].push(itemIndex, itemIndex);\n            summary.outputs[cellIndex].push(summary.outputs[cellIndex][summary.outputs[cellIndex].length - 1]);\n            summary.outputs[cellIndex].push((0, _idx.idx)(function () {\n              return summary.tops[index];\n            }, summary.outputs[cellIndex][summary.outputs[cellIndex].length - 1]));\n            summary.itemIndexes[cellIndex].push(itemIndex);\n          });\n          summary.inputs.forEach(function (inputs, index) {\n            inputs.push(Number.MAX_SAFE_INTEGER);\n            summary.inputItemIndexes[index].push(summary.inputItemIndexes[index][summary.inputItemIndexes[index].length - 1]);\n          });\n          summary.outputs.forEach(function (outputs) {\n            return outputs.push(outputs[outputs.length - 1]);\n          });\n        });\n        columnSummaries.forEach(function (summary) {\n          var itemRefs = [];\n          summary.itemIndexes.forEach(function () {\n            itemRefs.push(_react.default.createRef());\n          });\n\n          _this2._itemRefs.push(itemRefs);\n        });\n      }\n\n      return _react.default.createElement(_reactNativeSpringScrollview.SpringScrollView, (0, _extends2.default)({}, this.props, {\n        contentStyle: {\n          height: sumHeight\n        },\n        ref: this._scrollView,\n        onScroll: this._onScroll,\n        onNativeContentOffsetExtract: this._nativeOffset,\n        onSizeChange: this._onSizeChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 7\n        }\n      }), this._renderHeader(), columnSummaries.map(function (summary, index) {\n        return summary.itemIndexes.map(function (itemIndex, cellIndex) {\n          return _react.default.createElement(_WaterfallItem.WaterfallItem, (0, _extends2.default)({}, _this2.props, {\n            key: summary.inputItemIndexes[cellIndex][0],\n            ref: _this2._itemRefs[index][cellIndex],\n            offset: _this2._contentOffsetY,\n            itemIndexes: summary.inputItemIndexes[cellIndex],\n            input: summary.inputs[cellIndex],\n            output: summary.outputs[cellIndex],\n            style: _reactNative.StyleSheet.flatten([_styles.styles.leftTop, {\n              width: _this2._size.width / numColumns,\n              transform: [{\n                translateY: _this2._offset.interpolate({\n                  inputRange: summary.inputs[cellIndex],\n                  outputRange: summary.outputs[cellIndex]\n                })\n              }, {\n                translateX: _this2._size.width / numColumns * index\n              }]\n            }]),\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 167,\n              columnNumber: 13\n            }\n          }));\n        });\n      }), this._renderFooter());\n    }\n  }, {\n    key: \"_renderHeader\",\n    value: function _renderHeader() {\n      var renderHeader = this.props.renderHeader;\n      if (!renderHeader) return null;\n      var transform = {\n        transform: [{\n          translateY: this._shouldRenderContent() ? 0 : 10000\n        }]\n      };\n\n      var header = _react.default.Children.only(renderHeader());\n\n      this._orgOnHeaderLayout = header.onLayout;\n      return _react.default.cloneElement(header, {\n        style: _reactNative.StyleSheet.flatten([header.props.style, transform]),\n        onLayout: this._onHeaderLayout\n      });\n    }\n  }, {\n    key: \"_renderFooter\",\n    value: function _renderFooter() {\n      var renderFooter = this.props.renderFooter;\n      if (!renderFooter) return null;\n      var transform = {\n        transform: [{\n          translateY: this._shouldRenderContent() ? 0 : 10000\n        }]\n      };\n\n      var footer = _react.default.Children.only(renderFooter());\n\n      this._orgOnFooterLayout = footer.onLayout;\n      return _react.default.cloneElement(footer, {\n        style: _reactNative.StyleSheet.flatten([_styles.styles.footer, footer.props.style, transform]),\n        onLayout: this._onFooterLayout\n      });\n    }\n  }, {\n    key: \"_shouldRenderContent\",\n    value: function _shouldRenderContent() {\n      var _this$props2 = this.props,\n          renderHeader = _this$props2.renderHeader,\n          renderFooter = _this$props2.renderFooter;\n      return this._size && (!renderHeader || this._headerLayout) && (!renderFooter || this._footerLayout);\n    }\n  }, {\n    key: \"scrollTo\",\n    value: function scrollTo(offset) {\n      var _this3 = this;\n\n      var animated = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      if (!this._scrollView.current) return Promise.reject(\"WaterfallList has not been initialized yet!\");\n      this._shouldUpdateContent = false;\n\n      this._itemRefs.forEach(function (column) {\n        return column.forEach(function (itemRef) {\n          return (0, _idx.idx)(itemRef.current.updateOffset(offset.y));\n        });\n      });\n\n      return this._scrollView.current.scrollTo(offset, animated).then(function () {\n        _this3._shouldUpdateContent = true;\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"endRefresh\",\n    value: function endRefresh() {\n      var _this4 = this;\n\n      (0, _idx.idx)(function () {\n        return _this4._scrollView.current.endRefresh();\n      });\n    }\n  }, {\n    key: \"endLoading\",\n    value: function endLoading() {\n      var _this5 = this;\n\n      (0, _idx.idx)(function () {\n        return _this5._scrollView.current.endLoading();\n      });\n    }\n  }]);\n  return WaterfallList;\n}(_react.default.PureComponent);\n\nexports.WaterfallList = WaterfallList;","map":{"version":3,"sources":["C:/Users/ADMINS/Desktop/GreenApp/CoffeXanh/node_modules/react-native-largelist-v3/WaterfallList.js"],"names":["screenLayout","Dimensions","get","screenHeight","Math","max","width","height","WaterfallList","props","_contentOffsetY","_shouldUpdateContent","_scrollView","React","createRef","_onSizeChange","size","_size","_shouldRenderContent","forceUpdate","_onHeaderLayout","e","_headerLayout","nativeEvent","layout","_orgOnHeaderLayout","_onFooterLayout","_footerLayout","_orgOnFooterLayout","_onScroll","contentOffset","y","now","Date","getTime","_lastTick","_itemRefs","forEach","column","itemRef","current","updateOffset","onScroll","obtainOffset","onNativeContentOffsetExtract","_nativeOffset","x","Animated","Value","_offset","numColumns","heightForItem","data","preferColumnWidth","columnSummaries","sumHeight","floor","i","push","indexes","tops","heights","cells","inputs","outputs","itemIndexes","inputItemIndexes","item","index","minHeight","Number","MAX_SAFE_INTEGER","minHeightIndex","summary","idx","lastHeight","length","lastTop","maxHeight","MIN_SAFE_INTEGER","viewport","top","first","undefined","splice","StyleSheet","hairlineWidth","itemIndex","cellIndex","itemRefs","_renderHeader","map","flatten","styles","leftTop","transform","translateY","interpolate","inputRange","outputRange","translateX","_renderFooter","renderHeader","header","Children","only","onLayout","cloneElement","style","renderFooter","footer","offset","animated","Promise","reject","scrollTo","then","resolve","endRefresh","endLoading","PureComponent"],"mappings":";;;;;;;;;;;;;;;;;;;;;AASA;;AAEA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;AAEA,IAAMA,YAAY,GAAGC,wBAAWC,GAAX,CAAe,QAAf,CAArB;;AACA,IAAMC,YAAY,GAAGC,IAAI,CAACC,GAAL,CAASL,YAAY,CAACM,KAAtB,EAA6BN,YAAY,CAACO,MAA1C,CAArB;;IAEaC,a;;;;;AAaX,yBAAYC,KAAZ,EAAmB;AAAA;;AAAA;AACjB,8BAAMA,KAAN;AADiB,UAPnBC,eAOmB,GAPD,CAOC;AAAA,UAHnBC,oBAGmB,GAHI,IAGJ;AAAA,UAFnBC,WAEmB,GAFPC,eAAMC,SAAN,EAEO;;AAAA,UAqMnBC,aArMmB,GAqMH,UAAAC,IAAI,EAAI;AACtB,YAAKC,KAAL,GAAaD,IAAb;AACA,UAAI,MAAKE,oBAAL,EAAJ,EAAiC,MAAKC,WAAL;AAClC,KAxMkB;;AAAA,UA0MnBC,eA1MmB,GA0MD,UAAAC,CAAC,EAAI;AACrB,UAAI,MAAKC,aAAL,IAAsB,MAAKA,aAAL,CAAmBf,MAAnB,KAA8Bc,CAAC,CAACE,WAAF,CAAcC,MAAd,CAAqBjB,MAA7E,EAAqF;AACrF,YAAKe,aAAL,GAAqBD,CAAC,CAACE,WAAF,CAAcC,MAAnC;AACA,YAAKC,kBAAL,IAA2B,MAAKA,kBAAL,CAAwBJ,CAAxB,CAA3B;AACA,UAAI,MAAKH,oBAAL,EAAJ,EAAiC,MAAKC,WAAL;AAClC,KA/MkB;;AAAA,UAiNnBO,eAjNmB,GAiND,UAAAL,CAAC,EAAI;AACrB,UAAI,MAAKM,aAAL,IAAsB,MAAKA,aAAL,CAAmBpB,MAAnB,KAA8Bc,CAAC,CAACE,WAAF,CAAcC,MAAd,CAAqBjB,MAA7E,EAAqF;AACrF,YAAKoB,aAAL,GAAqBN,CAAC,CAACE,WAAF,CAAcC,MAAnC;AACA,YAAKI,kBAAL,IAA2B,MAAKA,kBAAL,CAAwBP,CAAxB,CAA3B;AACA,UAAI,MAAKH,oBAAL,EAAJ,EAAiC,MAAKC,WAAL;AAClC,KAtNkB;;AAAA,UAwNnBU,SAxNmB,GAwNP,UAAAR,CAAC,EAAI;AACf,YAAKX,eAAL,GAAuBW,CAAC,CAACE,WAAF,CAAcO,aAAd,CAA4BC,CAAnD;AACA,UAAMC,GAAG,GAAG,IAAIC,IAAJ,GAAWC,OAAX,EAAZ;;AACA,UAAI,MAAKC,SAAL,GAAiBH,GAAjB,GAAuB,EAA3B,EAA+B;AAC7B,cAAKG,SAAL,GAAiBH,GAAjB;AACA;AACD;;AACD,YAAKG,SAAL,GAAiBH,GAAjB;AACA,YAAKrB,oBAAL,IACE,MAAKyB,SAAL,CAAeC,OAAf,CAAuB,UAAAC,MAAM;AAAA,eAC3BA,MAAM,CAACD,OAAP,CAAe,UAAAE,OAAO;AAAA,iBAAI,cAAI;AAAA,mBAAMA,OAAO,CAACC,OAAR,CAAgBC,YAAhB,CAA6B,MAAK/B,eAAlC,CAAN;AAAA,WAAJ,CAAJ;AAAA,SAAtB,CAD2B;AAAA,OAA7B,CADF;AAIA,YAAKC,oBAAL,IAA6B,MAAKF,KAAL,CAAWiC,QAAxC,IAAoD,MAAKjC,KAAL,CAAWiC,QAAX,CAAoBrB,CAApB,CAApD;AACD,KArOkB;;AAEjB,UAAKsB,YAAL;;AAFiB;AAGlB;;;;qDAEgClC,K,EAA0B;AACzD,UACEA,KAAK,CAACmC,4BAAN,IACA,KAAKnC,KAAL,CAAWmC,4BAAX,KAA4CnC,KAAK,CAACmC,4BAFpD,EAGE;AACA,aAAKD,YAAL;AACD;AACF;;;mCAEc;AACb,WAAKE,aAAL;AACEC,QAAAA,CAAC,EAAE,IAAIC,sBAASC,KAAb,CAAmB,CAAnB,CADL;AAEEjB,QAAAA,CAAC,EAAE,IAAIgB,sBAASC,KAAb,CAAmB,CAAnB;AAFL,SAGK,KAAKvC,KAAL,CAAWmC,4BAHhB;AAKA,WAAKK,OAAL,GAAe,KAAKJ,aAAL,CAAmBd,CAAlC;AACD;;;6BAEQ;AAAA;;AAAA,wBACsD,KAAKtB,KAD3D;AAAA,UACDyC,UADC,eACDA,UADC;AAAA,UACWC,aADX,eACWA,aADX;AAAA,UAC0BC,IAD1B,eAC0BA,IAD1B;AAAA,UACgCC,iBADhC,eACgCA,iBADhC;AAEP,UAAMC,eAAe,GAAG,EAAxB;AACA,UAAIC,SAAS,GAAG,IAAhB;;AACA,UAAI,KAAKrC,oBAAL,EAAJ,EAAiC;AAC/B,aAAKkB,SAAL,GAAiB,EAAjB;AACAmB,QAAAA,SAAS,GAAG,cAAI;AAAA,iBAAM,MAAI,CAACjC,aAAL,CAAmBf,MAAzB;AAAA,SAAJ,EAAqC,CAArC,CAAZ;AACA,YAAI,CAAC2C,UAAL,EAAiBA,UAAU,GAAG9C,IAAI,CAACoD,KAAL,CAAW,KAAKvC,KAAL,CAAWX,KAAX,GAAmB+C,iBAA9B,CAAb;;AACjB,aAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGP,UAApB,EAAgC,EAAEO,CAAlC,EAAqC;AACnCH,UAAAA,eAAe,CAACI,IAAhB,CAAqB;AACnBH,YAAAA,SAAS,EAAE,CADQ;AAEnBI,YAAAA,OAAO,EAAE,EAFU;AAGnBC,YAAAA,IAAI,EAAE,EAHa;AAInBC,YAAAA,OAAO,EAAE,EAJU;AAKnBC,YAAAA,KAAK,EAAE,EALY;AAMnBC,YAAAA,MAAM,EAAE,EANW;AAOnBC,YAAAA,OAAO,EAAE,EAPU;AAQnBC,YAAAA,WAAW,EAAE,EARM;AASnBC,YAAAA,gBAAgB,EAAE;AATC,WAArB;AAWD;;AACDd,QAAAA,IAAI,CAACf,OAAL,CAAa,UAAC8B,IAAD,EAAOC,KAAP,EAAiB;AAC5B,cAAM7D,MAAM,GAAG4C,aAAa,CAACgB,IAAD,EAAOC,KAAP,CAA5B;AACA,cAAIC,SAAS,GAAGC,MAAM,CAACC,gBAAvB;AACA,cAAIC,cAAc,GAAG,CAArB;AACAlB,UAAAA,eAAe,CAACjB,OAAhB,CAAwB,UAACoC,OAAD,EAAUC,GAAV,EAAkB;AACxC,gBAAIL,SAAS,GAAGI,OAAO,CAAClB,SAAxB,EAAmC;AACjCc,cAAAA,SAAS,GAAGI,OAAO,CAAClB,SAApB;AACAiB,cAAAA,cAAc,GAAGE,GAAjB;AACD;AACF,WALD;AAMA,cAAMC,UAAU,GAAG,cACjB;AAAA,mBAAMrB,eAAe,CAACkB,cAAD,CAAf,CAAgCX,OAAhC,CAAwCP,eAAe,CAACkB,cAAD,CAAf,CAAgCX,OAAhC,CAAwCe,MAAxC,GAAiD,CAAzF,CAAN;AAAA,WADiB,EAEjB,CAFiB,CAAnB;AAIAtB,UAAAA,eAAe,CAACkB,cAAD,CAAf,CAAgCjB,SAAhC,IAA6ChD,MAA7C;AACA+C,UAAAA,eAAe,CAACkB,cAAD,CAAf,CAAgCX,OAAhC,CAAwCH,IAAxC,CAA6CnD,MAA7C;AACA+C,UAAAA,eAAe,CAACkB,cAAD,CAAf,CAAgCb,OAAhC,CAAwCD,IAAxC,CAA6CU,KAA7C;AACA,cAAMS,OAAO,GAAG,cACd;AAAA,mBAAMvB,eAAe,CAACkB,cAAD,CAAf,CAAgCZ,IAAhC,CAAqCN,eAAe,CAACkB,cAAD,CAAf,CAAgCZ,IAAhC,CAAqCgB,MAArC,GAA8C,CAAnF,CAAN;AAAA,WADc,EAEd,cAAI;AAAA,mBAAM,MAAI,CAACtD,aAAL,CAAmBf,MAAzB;AAAA,WAAJ,EAAqC,CAArC,CAFc,CAAhB;AAIA+C,UAAAA,eAAe,CAACkB,cAAD,CAAf,CAAgCZ,IAAhC,CAAqCF,IAArC,CAA0CmB,OAAO,GAAGF,UAApD;AACD,SAtBD;AAuBA,YAAIG,SAAS,GAAGR,MAAM,CAACS,gBAAvB;AACAzB,QAAAA,eAAe,CAACjB,OAAhB,CAAwB,UAAAoC,OAAO,EAAI;AACjC,cAAIK,SAAS,GAAGL,OAAO,CAAClB,SAAxB,EAAmC;AACjCuB,YAAAA,SAAS,GAAGL,OAAO,CAAClB,SAApB;AACD;;AACD,cAAMyB,QAAQ,GAAG,EAAjB;AACAP,UAAAA,OAAO,CAACb,IAAR,CAAavB,OAAb,CAAqB,UAAC4C,GAAD,EAAMb,KAAN,EAAgB;AACnC,gBAAMc,KAAK,GAAGF,QAAQ,CAAC,CAAD,CAAtB;;AACA,gBAAIE,KAAK,KAAKC,SAAV,IAAuBF,GAAG,GAAGR,OAAO,CAACZ,OAAR,CAAgBO,KAAhB,CAAN,GAA+Bc,KAA/B,GAAuC/E,YAAlE,EAAgF;AAC9E6E,cAAAA,QAAQ,CAACI,MAAT,CAAgB,CAAhB,EAAmB,CAAnB;AACD;;AACDJ,YAAAA,QAAQ,CAACtB,IAAT,CAAcuB,GAAd;;AACA,mBAAOR,OAAO,CAACX,KAAR,CAAcc,MAAd,GAAuBI,QAAQ,CAACJ,MAAT,GAAkB,CAAhD;AAAmDH,cAAAA,OAAO,CAACX,KAAR,CAAcJ,IAAd,CAAmBe,OAAO,CAACX,KAAR,CAAcc,MAAjC;AAAnD;AACD,WAPD;AAQD,SAbD;AAcArB,QAAAA,SAAS,IAAIuB,SAAb;AACAvB,QAAAA,SAAS,IAAI,cAAI;AAAA,iBAAM,MAAI,CAAC5B,aAAL,CAAmBpB,MAAzB;AAAA,SAAJ,EAAqC,CAArC,CAAb;AACA,YAAIgD,SAAS,IAAI,KAAKtC,KAAL,CAAWV,MAA5B,EAAoCgD,SAAS,GAAG,KAAKtC,KAAL,CAAWV,MAAX,GAAoB8E,wBAAWC,aAA3C;AACpChC,QAAAA,eAAe,CAACjB,OAAhB,CAAwB,UAAAoC,OAAO,EAAI;AACjCA,UAAAA,OAAO,CAACd,OAAR,CAAgBtB,OAAhB,CAAwB,UAACkD,SAAD,EAAYnB,KAAZ,EAAsB;AAC5C,gBAAMoB,SAAS,GAAGpB,KAAK,GAAGK,OAAO,CAACX,KAAR,CAAcc,MAAxC;;AACA,gBAAI,CAACH,OAAO,CAACV,MAAR,CAAeyB,SAAf,CAAL,EAAgC;AAC9Bf,cAAAA,OAAO,CAACV,MAAR,CAAeyB,SAAf,IAA4B,CAAClB,MAAM,CAACS,gBAAR,CAA5B;AACAN,cAAAA,OAAO,CAACP,gBAAR,CAAyBsB,SAAzB,IAAsC,CAACD,SAAD,CAAtC;AACD;;AACD,gBAAI,CAACd,OAAO,CAACT,OAAR,CAAgBwB,SAAhB,CAAL,EAAiCf,OAAO,CAACT,OAAR,CAAgBwB,SAAhB,IAA6B,CAAC,cAAI;AAAA,qBAAMf,OAAO,CAACb,IAAR,CAAaQ,KAAb,CAAN;AAAA,aAAJ,EAA+B,CAA/B,CAAD,CAA7B;AACjC,gBAAI,CAACK,OAAO,CAACR,WAAR,CAAoBuB,SAApB,CAAL,EAAqCf,OAAO,CAACR,WAAR,CAAoBuB,SAApB,IAAiC,EAAjC;AACrCf,YAAAA,OAAO,CAACV,MAAR,CAAeyB,SAAf,EAA0B9B,IAA1B,CACEe,OAAO,CAACb,IAAR,CAAaQ,KAAb,IAAsB,MAAI,CAACnD,KAAL,CAAWV,MADnC,EAEEkE,OAAO,CAACb,IAAR,CAAaQ,KAAb,IAAsB,MAAI,CAACnD,KAAL,CAAWV,MAAjC,GAA0C,GAF5C;AAIAkE,YAAAA,OAAO,CAACP,gBAAR,CAAyBsB,SAAzB,EAAoC9B,IAApC,CAAyC6B,SAAzC,EAAoDA,SAApD;AACAd,YAAAA,OAAO,CAACT,OAAR,CAAgBwB,SAAhB,EAA2B9B,IAA3B,CAAgCe,OAAO,CAACT,OAAR,CAAgBwB,SAAhB,EAA2Bf,OAAO,CAACT,OAAR,CAAgBwB,SAAhB,EAA2BZ,MAA3B,GAAoC,CAA/D,CAAhC;AACAH,YAAAA,OAAO,CAACT,OAAR,CAAgBwB,SAAhB,EAA2B9B,IAA3B,CACE,cAAI;AAAA,qBAAMe,OAAO,CAACb,IAAR,CAAaQ,KAAb,CAAN;AAAA,aAAJ,EAA+BK,OAAO,CAACT,OAAR,CAAgBwB,SAAhB,EAA2Bf,OAAO,CAACT,OAAR,CAAgBwB,SAAhB,EAA2BZ,MAA3B,GAAoC,CAA/D,CAA/B,CADF;AAGAH,YAAAA,OAAO,CAACR,WAAR,CAAoBuB,SAApB,EAA+B9B,IAA/B,CAAoC6B,SAApC;AACD,WAlBD;AAmBAd,UAAAA,OAAO,CAACV,MAAR,CAAe1B,OAAf,CAAuB,UAAC0B,MAAD,EAASK,KAAT,EAAmB;AACxCL,YAAAA,MAAM,CAACL,IAAP,CAAYY,MAAM,CAACC,gBAAnB;AACAE,YAAAA,OAAO,CAACP,gBAAR,CAAyBE,KAAzB,EAAgCV,IAAhC,CACEe,OAAO,CAACP,gBAAR,CAAyBE,KAAzB,EAAgCK,OAAO,CAACP,gBAAR,CAAyBE,KAAzB,EAAgCQ,MAAhC,GAAyC,CAAzE,CADF;AAGD,WALD;AAMAH,UAAAA,OAAO,CAACT,OAAR,CAAgB3B,OAAhB,CAAwB,UAAA2B,OAAO;AAAA,mBAAIA,OAAO,CAACN,IAAR,CAAaM,OAAO,CAACA,OAAO,CAACY,MAAR,GAAiB,CAAlB,CAApB,CAAJ;AAAA,WAA/B;AACD,SA3BD;AA4BAtB,QAAAA,eAAe,CAACjB,OAAhB,CAAwB,UAAAoC,OAAO,EAAI;AACjC,cAAMgB,QAAQ,GAAG,EAAjB;AACAhB,UAAAA,OAAO,CAACR,WAAR,CAAoB5B,OAApB,CAA4B,YAAM;AAChCoD,YAAAA,QAAQ,CAAC/B,IAAT,CAAc7C,eAAMC,SAAN,EAAd;AACD,WAFD;;AAGA,UAAA,MAAI,CAACsB,SAAL,CAAesB,IAAf,CAAoB+B,QAApB;AACD,SAND;AAOD;;AACD,aACE,6BAAC,6CAAD,6BACM,KAAKhF,KADX;AAEE,QAAA,YAAY,EAAE;AAAEF,UAAAA,MAAM,EAAEgD;AAAV,SAFhB;AAGE,QAAA,GAAG,EAAE,KAAK3C,WAHZ;AAIE,QAAA,QAAQ,EAAE,KAAKiB,SAJjB;AAKE,QAAA,4BAA4B,EAAE,KAAKgB,aALrC;AAME,QAAA,YAAY,EAAE,KAAK9B,aANrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAQG,KAAK2E,aAAL,EARH,EASGpC,eAAe,CAACqC,GAAhB,CAAoB,UAAClB,OAAD,EAAUL,KAAV;AAAA,eACnBK,OAAO,CAACR,WAAR,CAAoB0B,GAApB,CAAwB,UAACJ,SAAD,EAAYC,SAAZ;AAAA,iBACtB,6BAAC,4BAAD,6BACM,MAAI,CAAC/E,KADX;AAEE,YAAA,GAAG,EAAEgE,OAAO,CAACP,gBAAR,CAAyBsB,SAAzB,EAAoC,CAApC,CAFP;AAGE,YAAA,GAAG,EAAE,MAAI,CAACpD,SAAL,CAAegC,KAAf,EAAsBoB,SAAtB,CAHP;AAIE,YAAA,MAAM,EAAE,MAAI,CAAC9E,eAJf;AAKE,YAAA,WAAW,EAAE+D,OAAO,CAACP,gBAAR,CAAyBsB,SAAzB,CALf;AAME,YAAA,KAAK,EAAEf,OAAO,CAACV,MAAR,CAAeyB,SAAf,CANT;AAOE,YAAA,MAAM,EAAEf,OAAO,CAACT,OAAR,CAAgBwB,SAAhB,CAPV;AAQE,YAAA,KAAK,EAAEH,wBAAWO,OAAX,CAAmB,CACxBC,eAAOC,OADiB,EAExB;AACExF,cAAAA,KAAK,EAAE,MAAI,CAACW,KAAL,CAAWX,KAAX,GAAmB4C,UAD5B;AAEE6C,cAAAA,SAAS,EAAE,CACT;AACEC,gBAAAA,UAAU,EAAE,MAAI,CAAC/C,OAAL,CAAagD,WAAb,CAAyB;AACnCC,kBAAAA,UAAU,EAAEzB,OAAO,CAACV,MAAR,CAAeyB,SAAf,CADuB;AAEnCW,kBAAAA,WAAW,EAAE1B,OAAO,CAACT,OAAR,CAAgBwB,SAAhB;AAFsB,iBAAzB;AADd,eADS,EAOT;AAAEY,gBAAAA,UAAU,EAAE,MAAI,CAACnF,KAAL,CAAWX,KAAX,GAAmB4C,UAAnB,GAAgCkB;AAA9C,eAPS;AAFb,aAFwB,CAAnB,CART;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aADsB;AAAA,SAAxB,CADmB;AAAA,OAApB,CATH,EAqCG,KAAKiC,aAAL,EArCH,CADF;AAyCD;;;oCAEe;AAAA,UACNC,YADM,GACW,KAAK7F,KADhB,CACN6F,YADM;AAEd,UAAI,CAACA,YAAL,EAAmB,OAAO,IAAP;AACnB,UAAMP,SAAS,GAAG;AAChBA,QAAAA,SAAS,EAAE,CAAC;AAAEC,UAAAA,UAAU,EAAE,KAAK9E,oBAAL,KAA8B,CAA9B,GAAkC;AAAhD,SAAD;AADK,OAAlB;;AAGA,UAAMqF,MAAM,GAAG1F,eAAM2F,QAAN,CAAeC,IAAf,CAAoBH,YAAY,EAAhC,CAAf;;AACA,WAAK7E,kBAAL,GAA0B8E,MAAM,CAACG,QAAjC;AACA,aAAO7F,eAAM8F,YAAN,CAAmBJ,MAAnB,EAA2B;AAChCK,QAAAA,KAAK,EAAEvB,wBAAWO,OAAX,CAAmB,CAACW,MAAM,CAAC9F,KAAP,CAAamG,KAAd,EAAqBb,SAArB,CAAnB,CADyB;AAEhCW,QAAAA,QAAQ,EAAE,KAAKtF;AAFiB,OAA3B,CAAP;AAID;;;oCAEe;AAAA,UACNyF,YADM,GACW,KAAKpG,KADhB,CACNoG,YADM;AAEd,UAAI,CAACA,YAAL,EAAmB,OAAO,IAAP;AACnB,UAAMd,SAAS,GAAG;AAChBA,QAAAA,SAAS,EAAE,CAAC;AAAEC,UAAAA,UAAU,EAAE,KAAK9E,oBAAL,KAA8B,CAA9B,GAAkC;AAAhD,SAAD;AADK,OAAlB;;AAGA,UAAM4F,MAAM,GAAGjG,eAAM2F,QAAN,CAAeC,IAAf,CAAoBI,YAAY,EAAhC,CAAf;;AACA,WAAKjF,kBAAL,GAA0BkF,MAAM,CAACJ,QAAjC;AACA,aAAO7F,eAAM8F,YAAN,CAAmBG,MAAnB,EAA2B;AAChCF,QAAAA,KAAK,EAAEvB,wBAAWO,OAAX,CAAmB,CAACC,eAAOiB,MAAR,EAAgBA,MAAM,CAACrG,KAAP,CAAamG,KAA7B,EAAoCb,SAApC,CAAnB,CADyB;AAEhCW,QAAAA,QAAQ,EAAE,KAAKhF;AAFiB,OAA3B,CAAP;AAID;;;2CAEsB;AAAA,yBACkB,KAAKjB,KADvB;AAAA,UACb6F,YADa,gBACbA,YADa;AAAA,UACCO,YADD,gBACCA,YADD;AAErB,aAAO,KAAK5F,KAAL,KAAe,CAACqF,YAAD,IAAiB,KAAKhF,aAArC,MAAwD,CAACuF,YAAD,IAAiB,KAAKlF,aAA9E,CAAP;AACD;;;6BAoCQoF,M,EAAyD;AAAA;;AAAA,UAAzCC,QAAyC,uEAArB,IAAqB;AAChE,UAAI,CAAC,KAAKpG,WAAL,CAAiB4B,OAAtB,EAA+B,OAAOyE,OAAO,CAACC,MAAR,CAAe,6CAAf,CAAP;AAC/B,WAAKvG,oBAAL,GAA4B,KAA5B;;AACA,WAAKyB,SAAL,CAAeC,OAAf,CAAuB,UAAAC,MAAM;AAAA,eAAIA,MAAM,CAACD,OAAP,CAAe,UAAAE,OAAO;AAAA,iBAAI,cAAIA,OAAO,CAACC,OAAR,CAAgBC,YAAhB,CAA6BsE,MAAM,CAAChF,CAApC,CAAJ,CAAJ;AAAA,SAAtB,CAAJ;AAAA,OAA7B;;AACA,aAAO,KAAKnB,WAAL,CAAiB4B,OAAjB,CAAyB2E,QAAzB,CAAkCJ,MAAlC,EAA0CC,QAA1C,EAAoDI,IAApD,CAAyD,YAAM;AACpE,QAAA,MAAI,CAACzG,oBAAL,GAA4B,IAA5B;AACA,eAAOsG,OAAO,CAACI,OAAR,EAAP;AACD,OAHM,CAAP;AAID;;;iCAEY;AAAA;;AACX,oBAAI;AAAA,eAAM,MAAI,CAACzG,WAAL,CAAiB4B,OAAjB,CAAyB8E,UAAzB,EAAN;AAAA,OAAJ;AACD;;;iCAEY;AAAA;;AACX,oBAAI;AAAA,eAAM,MAAI,CAAC1G,WAAL,CAAiB4B,OAAjB,CAAyB+E,UAAzB,EAAN;AAAA,OAAJ;AACD;;;EApQgC1G,eAAM2G,a","sourcesContent":["/*\n *\n * Created by Stone\n * https://github.com/bolan9999\n * Email: shanshang130@gmail.com\n * Date: 2019/2/20\n *\n */\n\nimport React from \"react\";\nimport type { LargeListPropType, Offset, Size, WaterfallListType } from \"./Types\";\nimport { SpringScrollView } from \"react-native-spring-scrollview\";\nimport { Animated, Dimensions, StyleSheet, View, LayoutAnimation, Platform } from \"react-native\";\nimport { styles } from \"./styles\";\nimport { idx } from \"./idx\";\nimport { WaterfallItem } from \"./WaterfallItem\";\n\nconst screenLayout = Dimensions.get(\"window\");\nconst screenHeight = Math.max(screenLayout.width, screenLayout.height);\n\nexport class WaterfallList extends React.PureComponent<WaterfallListType> {\n  _size: Size;\n  _headerLayout;\n  _footerLayout;\n  _orgOnHeaderLayout;\n  _orgOnFooterLayout;\n  _contentOffsetY = 0;\n  _nativeOffset;\n  _offset: Animated.Value;\n  _itemRefs: [];\n  _shouldUpdateContent = true;\n  _scrollView=React.createRef();\n\n  constructor(props) {\n    super(props);\n    this.obtainOffset();\n  }\n\n  UNSAFE_componentWillReceiveProps(props: LargeListPropType) {\n    if (\n      props.onNativeContentOffsetExtract &&\n      this.props.onNativeContentOffsetExtract !== props.onNativeContentOffsetExtract\n    ) {\n      this.obtainOffset();\n    }\n  }\n\n  obtainOffset() {\n    this._nativeOffset = {\n      x: new Animated.Value(0),\n      y: new Animated.Value(0),\n      ...this.props.onNativeContentOffsetExtract\n    };\n    this._offset = this._nativeOffset.y;\n  }\n\n  render() {\n    let { numColumns, heightForItem, data, preferColumnWidth } = this.props;\n    const columnSummaries = [];\n    let sumHeight = null;\n    if (this._shouldRenderContent()) {\n      this._itemRefs = [];\n      sumHeight = idx(() => this._headerLayout.height, 0);\n      if (!numColumns) numColumns = Math.floor(this._size.width / preferColumnWidth);\n      for (let i = 0; i < numColumns; ++i) {\n        columnSummaries.push({\n          sumHeight: 0,\n          indexes: [],\n          tops: [],\n          heights: [],\n          cells: [],\n          inputs: [],\n          outputs: [],\n          itemIndexes: [],\n          inputItemIndexes: []\n        });\n      }\n      data.forEach((item, index) => {\n        const height = heightForItem(item, index);\n        let minHeight = Number.MAX_SAFE_INTEGER;\n        let minHeightIndex = 0;\n        columnSummaries.forEach((summary, idx) => {\n          if (minHeight > summary.sumHeight) {\n            minHeight = summary.sumHeight;\n            minHeightIndex = idx;\n          }\n        });\n        const lastHeight = idx(\n          () => columnSummaries[minHeightIndex].heights[columnSummaries[minHeightIndex].heights.length - 1],\n          0\n        );\n        columnSummaries[minHeightIndex].sumHeight += height;\n        columnSummaries[minHeightIndex].heights.push(height);\n        columnSummaries[minHeightIndex].indexes.push(index);\n        const lastTop = idx(\n          () => columnSummaries[minHeightIndex].tops[columnSummaries[minHeightIndex].tops.length - 1],\n          idx(() => this._headerLayout.height, 0)\n        );\n        columnSummaries[minHeightIndex].tops.push(lastTop + lastHeight);\n      });\n      let maxHeight = Number.MIN_SAFE_INTEGER;\n      columnSummaries.forEach(summary => {\n        if (maxHeight < summary.sumHeight) {\n          maxHeight = summary.sumHeight;\n        }\n        const viewport = [];\n        summary.tops.forEach((top, index) => {\n          const first = viewport[0];\n          if (first !== undefined && top + summary.heights[index] - first > screenHeight) {\n            viewport.splice(0, 1);\n          }\n          viewport.push(top);\n          while (summary.cells.length < viewport.length + 2) summary.cells.push(summary.cells.length);\n        });\n      });\n      sumHeight += maxHeight;\n      sumHeight += idx(() => this._footerLayout.height, 0);\n      if (sumHeight <= this._size.height) sumHeight = this._size.height + StyleSheet.hairlineWidth;\n      columnSummaries.forEach(summary => {\n        summary.indexes.forEach((itemIndex, index) => {\n          const cellIndex = index % summary.cells.length;\n          if (!summary.inputs[cellIndex]) {\n            summary.inputs[cellIndex] = [Number.MIN_SAFE_INTEGER];\n            summary.inputItemIndexes[cellIndex] = [itemIndex];\n          }\n          if (!summary.outputs[cellIndex]) summary.outputs[cellIndex] = [idx(() => summary.tops[index], 0)];\n          if (!summary.itemIndexes[cellIndex]) summary.itemIndexes[cellIndex] = [];\n          summary.inputs[cellIndex].push(\n            summary.tops[index] - this._size.height,\n            summary.tops[index] - this._size.height + 0.1\n          );\n          summary.inputItemIndexes[cellIndex].push(itemIndex, itemIndex);\n          summary.outputs[cellIndex].push(summary.outputs[cellIndex][summary.outputs[cellIndex].length - 1]);\n          summary.outputs[cellIndex].push(\n            idx(() => summary.tops[index], summary.outputs[cellIndex][summary.outputs[cellIndex].length - 1])\n          );\n          summary.itemIndexes[cellIndex].push(itemIndex);\n        });\n        summary.inputs.forEach((inputs, index) => {\n          inputs.push(Number.MAX_SAFE_INTEGER);\n          summary.inputItemIndexes[index].push(\n            summary.inputItemIndexes[index][summary.inputItemIndexes[index].length - 1]\n          );\n        });\n        summary.outputs.forEach(outputs => outputs.push(outputs[outputs.length - 1]));\n      });\n      columnSummaries.forEach(summary => {\n        const itemRefs = [];\n        summary.itemIndexes.forEach(() => {\n          itemRefs.push(React.createRef());\n        });\n        this._itemRefs.push(itemRefs);\n      });\n    }\n    return (\n      <SpringScrollView\n        {...this.props}\n        contentStyle={{ height: sumHeight }}\n        ref={this._scrollView}\n        onScroll={this._onScroll}\n        onNativeContentOffsetExtract={this._nativeOffset}\n        onSizeChange={this._onSizeChange}\n      >\n        {this._renderHeader()}\n        {columnSummaries.map((summary, index) =>\n          summary.itemIndexes.map((itemIndex, cellIndex) =>\n            <WaterfallItem\n              {...this.props}\n              key={summary.inputItemIndexes[cellIndex][0]}\n              ref={this._itemRefs[index][cellIndex]}\n              offset={this._contentOffsetY}\n              itemIndexes={summary.inputItemIndexes[cellIndex]}\n              input={summary.inputs[cellIndex]}\n              output={summary.outputs[cellIndex]}\n              style={StyleSheet.flatten([\n                styles.leftTop,\n                {\n                  width: this._size.width / numColumns,\n                  transform: [\n                    {\n                      translateY: this._offset.interpolate({\n                        inputRange: summary.inputs[cellIndex],\n                        outputRange: summary.outputs[cellIndex]\n                      })\n                    },\n                    { translateX: this._size.width / numColumns * index }\n                  ]\n                }\n              ])}\n            />\n          )\n        )}\n        {this._renderFooter()}\n      </SpringScrollView>\n    );\n  }\n\n  _renderHeader() {\n    const { renderHeader } = this.props;\n    if (!renderHeader) return null;\n    const transform = {\n      transform: [{ translateY: this._shouldRenderContent() ? 0 : 10000 }]\n    };\n    const header = React.Children.only(renderHeader());\n    this._orgOnHeaderLayout = header.onLayout;\n    return React.cloneElement(header, {\n      style: StyleSheet.flatten([header.props.style, transform]),\n      onLayout: this._onHeaderLayout\n    });\n  }\n\n  _renderFooter() {\n    const { renderFooter } = this.props;\n    if (!renderFooter) return null;\n    const transform = {\n      transform: [{ translateY: this._shouldRenderContent() ? 0 : 10000 }]\n    };\n    const footer = React.Children.only(renderFooter());\n    this._orgOnFooterLayout = footer.onLayout;\n    return React.cloneElement(footer, {\n      style: StyleSheet.flatten([styles.footer, footer.props.style, transform]),\n      onLayout: this._onFooterLayout\n    });\n  }\n\n  _shouldRenderContent() {\n    const { renderHeader, renderFooter } = this.props;\n    return this._size && (!renderHeader || this._headerLayout) && (!renderFooter || this._footerLayout);\n  }\n\n  _onSizeChange = size => {\n    this._size = size;\n    if (this._shouldRenderContent()) this.forceUpdate();\n  };\n\n  _onHeaderLayout = e => {\n    if (this._headerLayout && this._headerLayout.height === e.nativeEvent.layout.height) return;\n    this._headerLayout = e.nativeEvent.layout;\n    this._orgOnHeaderLayout && this._orgOnHeaderLayout(e);\n    if (this._shouldRenderContent()) this.forceUpdate();\n  };\n\n  _onFooterLayout = e => {\n    if (this._footerLayout && this._footerLayout.height === e.nativeEvent.layout.height) return;\n    this._footerLayout = e.nativeEvent.layout;\n    this._orgOnFooterLayout && this._orgOnFooterLayout(e);\n    if (this._shouldRenderContent()) this.forceUpdate();\n  };\n\n  _onScroll = e => {\n    this._contentOffsetY = e.nativeEvent.contentOffset.y;\n    const now = new Date().getTime();\n    if (this._lastTick - now > 30) {\n      this._lastTick = now;\n      return;\n    }\n    this._lastTick = now;\n    this._shouldUpdateContent &&\n      this._itemRefs.forEach(column =>\n        column.forEach(itemRef => idx(() => itemRef.current.updateOffset(this._contentOffsetY)))\n      );\n    this._shouldUpdateContent && this.props.onScroll && this.props.onScroll(e);\n  };\n\n  scrollTo(offset: Offset, animated: boolean = true): Promise<void> {\n    if (!this._scrollView.current) return Promise.reject(\"WaterfallList has not been initialized yet!\");\n    this._shouldUpdateContent = false;\n    this._itemRefs.forEach(column => column.forEach(itemRef => idx(itemRef.current.updateOffset(offset.y))));\n    return this._scrollView.current.scrollTo(offset, animated).then(() => {\n      this._shouldUpdateContent = true;\n      return Promise.resolve();\n    });\n  }\n\n  endRefresh() {\n    idx(() => this._scrollView.current.endRefresh());\n  }\n\n  endLoading() {\n    idx(() => this._scrollView.current.endLoading());\n  }\n}\n"]},"metadata":{},"sourceType":"script"}